### 1、下面是我的迁移文件
```php
Schema::create('personal_access_tokens', function (Blueprint $table) {
    $table->id();
    $table->morphs('tokenable');
    $table->string('name');
    $table->string('token', 64)->unique();
    $table->text('abilities')->nullable();
    $table->timestamp('last_used_at')->nullable();
    $table->timestamp('expires_at')->nullable();
    $table->timestamps();
});
Schema::create('approval_template', function (Blueprint $table) {
    $table->ulid('id')->primary()->comment('主键');
    $table->enum('flow_code', ['partner', 'publisher', 'finance', 'execution', 'workflow', 'project'])->comment('流程标识[partner:合作者审批,publisher:发布者审批,finance:财务审批,execution:执行流审批,workflow:工作流审批,project:项目审批]');
    $table->string('name')->comment('名称');
    $table->json('callback')->nullable()->comment('回调');
    $table->string('remark')->nullable()->comment('备注');
    $table->enum('status', ['enable', 'disable'])->default('enable')->comment('状态[enable:启用,disable:禁用]');
    MigrationHelper::createAndAdmin($table);
    $table->index('flow_code');
    $table->comment('审批模版表');
});
Schema::create('approval_node_template', function (Blueprint $table) {
    $table->ulid('id')->primary()->comment('主键');
    $table->ulid('parent_id')->nullable()->comment('父级id');
    $table->unsignedTinyInteger('depth')->default(1)->comment('步骤');
    $table->string('name')->comment('名称');
    $table->string('description')->nullable()->comment('描述');
    $table->enum('type', ['condition', 'approval', 'cc', 'subflow'])->comment('类型[condition:条件节点,approval:审核节点,cc:抄送节点,subflow:子流程节点]');
    $table->json('rules')->nullable()->comment('审批规则');
    $table->json('callback')->nullable()->comment('回调');
    $table->ulid('template_id')->comment('模版id');
    MigrationHelper::createAndAdmin($table);
    $table->index('parent_id');
    $table->index('template_id');
    $table->comment('审批节点模版表');
});
Schema::create('approval', function (Blueprint $table) {
    $table->ulid('id')->primary()->comment('主键');
    $table->ulid('parent_id')->nullable()->comment('父级id');
    $table->string('flow_code')->comment('流程标识');
    $table->string('title')->comment('标题');
    $table->enum('business_type', ['partner', 'publisher', 'finance', 'execution', 'workflow', 'project'])->comment('业务类型[partner:合作者审批,publisher:发布者审批,finance:财务审批,execution:执行流审批,workflow:工作流审批,project:项目审批]');
    $table->ulid('business_id')->comment('业务id');
    $table->enum('status', ['create', 'process', 'success', 'reject', 'cancel'])->comment('状态[create:创建,process:进行中,success:通过,reject:驳回,cancel:取消]');
    $table->json('node_template_snapshot')->nullable()->comment('节点模版快照');
    $table->json('callback')->nullable()->comment('回调');
    $table->enum('applicant_type', ['user', 'admin'])->default('user')->comment('申请人类型[user:用户,admin:管理员]');
    $table->ulid('applicant_id')->comment('申请人id');
    $table->json('extend')->nullable()->comment('额外信息');
    $table->ulid('template_id')->comment('模版id');
    MigrationHelper::createTime($table);
    $table->index(['business_type', 'business_id']);
    $table->index('status');
    $table->index('flow_code');
    $table->comment('审批实例表');
});
Schema::create('approval_node', function (Blueprint $table) {
    $table->ulid('id')->primary()->comment('编号');
    $table->ulid('parent_id')->nullable()->comment('父级id');
    $table->unsignedTinyInteger('depth')->default(1)->comment('步骤');
    $table->string('name')->comment('名称');
    $table->enum('type', ['condition', 'approval', 'cc', 'subflow'])->default('approval')->comment('类型[condition:条件节点,approval:审核节点,cc:抄送节点,subflow:子流程节点]');
    $table->json('rules')->comment('审批规则');
    $table->enum('status', ['process', 'approve', 'reject', 'skip', 'auto', 'cancel'])->comment('状态[process:审批中,approve:通过,reject:驳回,skip:跳过,auto:自动,cancel:取消]');
    $table->json('callback')->nullable()->comment('回调');
    $table->ulid('approval_id')->comment('审批id');
    $table->json('extend')->nullable()->comment('额外信息');
    MigrationHelper::createTime($table);
    $table->index('parent_id');
    $table->index('approval_id');
    $table->comment('审批节点实例表');
});
Schema::create('approval_node_task', function (Blueprint $table) {
    $table->ulid('id')->primary()->comment('编号');
    $table->ulid('approver_id')->comment('审批人id');
    $table->string('approver_name')->comment('审批人名称');
    $table->string('approver_type')->comment('审批人类型');
    $table->json('operation_info')->nullable()->comment('操作信息');
    $table->enum('status', ['process', 'approve', 'reject', 'skip', 'auto', 'cancel'])->comment('状态[process:审批中,approve:通过,reject:驳回,skip:跳过,auto:自动,cancel:取消]');
    $table->ulid('approval_node_id')->comment('审批节点id');
    $table->json('extend')->nullable()->comment('额外信息');
    MigrationHelper::createAndAdmin($table);
    $table->comment('审批节点任务实例表');
});
```
### 2、模型
```php
<?php

declare(strict_types=1);

namespace App\Models;

use Illuminate\Database\Eloquent\SoftDeletes;

/**
 * @property string $id
 * @property string $parent_id
 * @property string $flow_code
 * @property string $title
 * @property string $business_type
 * @property string $business_id
 * @property string $status
 * @property array $node_template_snapshot
 * @property array $callback
 * @property string $applicant_type
 * @property string $applicant_id
 * @property array $extend
 * @property string $template_id
 * @property string $created_at
 * @property string $updated_at
 * @property string $deleted_at
 */
class Approval extends BaseModel
{
    use SoftDeletes;

    protected $table = 'approval';

    protected $casts = [
        'node_template_snapshot' => 'json',
        'callback'               => 'json',
        'extend'                 => 'json',
    ];

    protected $fillable = [
        'id',
        'parent_id',
        'flow_code',
        'title',
        'business_type',
        'business_id',
        'status',
        'node_template_snapshot',
        'callback',
        'applicant_type',
        'applicant_id',
        'extend',
        'template_id',
        'created_at',
        'updated_at',
        'deleted_at',
    ];

    protected array $resource = [
        'id'                     => 'string',
        'parent_id'              => 'string',
        'flow_code'              => 'string',
        'title'                  => 'string',
        'business_type'          => 'string',
        'business_id'            => 'string',
        'status'                 => 'string',
        'node_template_snapshot' => 'array',
        'callback'               => 'array',
        'applicant_type'         => 'string',
        'applicant_id'           => 'string',
        'extend'                 => 'array',
        'template_id'            => 'string',
        'created_at'             => 'string',
        'updated_at'             => 'string',
        'deleted_at'             => 'string',
    ];
}
```
```php
<?php

declare(strict_types=1);

namespace App\Models;

use Illuminate\Database\Eloquent\SoftDeletes;

/**
 * @property string $id
 * @property string $parent_id
 * @property string $type
 * @property string $depth
 * @property string $name
 * @property string $method
 * @property string $status
 * @property array $callback
 * @property string $approval_id
 * @property array $extend
 * @property string $created_at
 * @property string $updated_at
 * @property string $deleted_at
 */
class ApprovalNode extends BaseModel
{
    use SoftDeletes;

    protected $table = 'approval_node';

    protected $casts = [
        'callback' => 'json',
        'extend'   => 'json',
    ];

    protected $fillable = [
        'id',
        'parent_id',
        'type',
        'depth',
        'name',
        'method',
        'status',
        'callback',
        'approval_id',
        'extend',
        'created_at',
        'updated_at',
        'deleted_at',
    ];

    protected array $resource = [
        'id'          => 'string',
        'parent_id'   => 'string',
        'type'        => 'string',
        'depth'       => 'string',
        'name'        => 'string',
        'method'      => 'string',
        'status'      => 'string',
        'callback'    => 'array',
        'approval_id' => 'string',
        'extend'      => 'array',
        'created_at'  => 'string',
        'updated_at'  => 'string',
        'deleted_at'  => 'string',
    ];
}
```
```php
<?php

declare(strict_types=1);

namespace App\Models;

use Illuminate\Database\Eloquent\SoftDeletes;

/**
 * @property string $id
 * @property string $approval_id
 * @property string $approver_name
 * @property string $approver_type
 * @property array $operation_info
 * @property string $status
 * @property string $approval_node_id
 * @property array $extend
 * @property string $created_at
 * @property string $created_admin_id
 * @property string $updated_at
 * @property string $updated_admin_id
 * @property string $deleted_at
 * @property string $deleted_admin_id
 *
 */
class ApprovalNodeTask extends BaseModel
{
    use SoftDeletes;

    protected $table = 'approval_node_task';

    protected $casts = [
        'operation_info' => 'json',
        'extend'         => 'json',
    ];

    protected $fillable = [
        'id',
        'approver_id',
        'approver_name',
        'approver_type',
        'operation_info',
        'status',
        'approval_node_id',
        'extend',
        'created_at',
        'created_admin_id',
        'updated_at',
        'updated_admin_id',
        'deleted_at',
        'deleted_admin_id',
    ];

    protected array $resource = [
        'id'               => 'string',
        'approver_id'      => 'string',
        'approver_name'    => 'string',
        'approver_type'    => 'string',
        'operation_info'   => 'array',
        'status'           => 'string',
        'approval_node_id' => 'string',
        'extend'           => 'array',
        'created_at'       => 'string',
        'created_admin_id' => 'string',
        'updated_at'       => 'string',
        'updated_admin_id' => 'string',
        'deleted_at'       => 'string',
        'deleted_admin_id' => 'string',
    ];
}
```
```php
<?php

declare(strict_types=1);

namespace App\Models;

use Illuminate\Database\Eloquent\SoftDeletes;

/**
 * @property string $id
 * @property string $parent_id
 * @property string $depth
 * @property string $name
 * @property string $description
 * @property string $type
 * @property string $rules
 * @property array $callback
 * @property string $template_id
 * @property string $created_at
 * @property string $created_admin_id
 * @property string $updated_at
 * @property string $updated_admin_id
 * @property string $deleted_at
 * @property string $deleted_admin_id
 */
class ApprovalNodeTemplate extends BaseModel
{
    use SoftDeletes;

    protected $table = 'approval_node_template';

    protected $casts = [
        'rules'    => 'json',
        'callback' => 'json',
    ];

    protected $fillable = [
        'id',
        'parent_id',
        'depth',
        'name',
        'description',
        'type',
        'rules',
        'callback',
        'template_id',
        'created_at',
        'created_admin_id',
        'updated_at',
        'updated_admin_id',
        'deleted_at',
        'deleted_admin_id',
    ];

    protected array $resource = [
        'id'          => 'string',
        'parent_id'   => 'string',
        'depth'       => 'string',
        'name'        => 'string',
        'description' => 'string',
        'type'        => 'string',
        'rules'       => 'string',
        'callback'    => 'array',
        'template_id' => 'string',
    ];

    public function children()
    {
        return $this->hasMany(self::class, 'parent_id', 'id')->with('children');
    }
}
```
```php
<?php

declare(strict_types=1);

namespace App\Models;

use Illuminate\Database\Eloquent\Relations\HasMany;
use Illuminate\Database\Eloquent\Relations\HasOne;
use Illuminate\Database\Eloquent\SoftDeletes;

/**
 * @property string $id
 * @property string $flow_code
 * @property string $name
 * @property array $callback
 * @property string $remark
 * @property string $status
 * @property string $created_at
 * @property string $created_admin_id
 * @property string $updated_at
 * @property string $updated_admin_id
 * @property string $deleted_at
 * @property string $deleted_admin_id
 */
class ApprovalTemplate extends BaseModel
{
    use SoftDeletes;

    protected $table = 'approval_template';

    protected $casts = [
        'callback' => 'json',
    ];

    protected $fillable = [
        'id',
        'flow_code',
        'name',
        'callback',
        'remark',
        'status',
        'created_at',
        'created_admin_id',
        'updated_at',
        'updated_admin_id',
        'deleted_at',
        'deleted_admin_id',
    ];

    protected array $resource = [
        'id'        => 'string',
        'flow_code' => 'string',
        'name'      => 'string',
        'callback'  => 'array',
        'remark'    => 'string',
        'status'    => 'string',
    ];

    /**
     * @return HasOne
     */
    public function nodeTemplate(): HasOne
    {
        return $this->hasOne(ApprovalNodeTemplate::class, 'template_id', 'id');
    }
}
```
### 3、控制器层
```php
<?php

namespace App\Http\Controllers\Web\V1;

use App\Http\Controllers\Controller;
use App\Http\Requests\Approval\ApprovalRequest;
use App\Services\ApprovalService;

class ApprovalController extends Controller
{
    public function __construct(
        private readonly ApprovalService $service,
    ) {}

    public function create(string $type, ApprovalRequest $request)
    {
        return $this->service->create($type, $request->all());
    }
}
```
### 4、服务层
```php
<?php

declare(strict_types=1);

namespace App\Services;

use App\Repositories\ApprovalRepositories;
use Illuminate\Http\JsonResponse;
use Service\Common\Library\Response\ApiResponse;

readonly class ApprovalService
{
    public function __construct(
        private ApprovalRepositories $repositories,
    ) {}

    public function create(string $type, array $inputs): JsonResponse
    {
        try {
            return ApiResponse::success();
        } catch (\Exception $e) {
            return ApiResponse::fail(message: $e->getMessage());
        }

    }
}
```
